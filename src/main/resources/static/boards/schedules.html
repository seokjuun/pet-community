<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>산책 시간표 - 펫 포테이토 커뮤니티</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/global.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/variables.css">
    <link rel="stylesheet" href="/assets/css/button.css">
    <link rel="stylesheet" href="/assets/css/footer.css">

    <link rel="stylesheet" href="/assets/css/schedules/friend.css">
    <link rel="stylesheet" href="/assets/css/schedules/modal.css">
    <link rel="stylesheet" href="/assets/css/schedules/schedules.css">
    <link rel="stylesheet" href="/assets/css/schedules/common.css">
</head>
<body>
<!-- Header -->
<header>
    <div class="header-top">
        <div class="container">
            <div class="header-contact">
                <span><i class="fas fa-phone"></i> +82 10-1717-6288</span>
                <span><i class="fas fa-envelope"></i> info@petpotato.com</span>
            </div>
            <div class="header-social">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>
    <div class="header-main">
        <div class="container">
            <a href="/index.html" class="logo">Pet Potato</a>
            <ul class="nav-menu">
                <li><a href="../index.html">홈</a></li>
                <li><a href="free.html">커뮤니티</a></li>
                <li><a href="schedules.html">산책 시간표</a></li>
            </ul>
            <div class="auth-buttons" id="authButtons">
                <a href="/login.html" class="btn btn-outline">로그인</a>
                <a href="/register.html" class="btn btn-primary">회원가입</a>
            </div>
        </div>
    </div>
</header>

<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <h1>반려동물 산책 시간표</h1>
        <p>나의 산책 일정을 관리하고 친구들과 함께 산책해보세요!</p>
    </div>
</section>

<!-- Main Content -->
<section class="container">
    <!-- Tabs -->
    <div class="tabs">
        <div class="tab-item active" data-tab="my-schedule">내 산책 시간표</div>
        <div class="tab-item" data-tab="friend-schedule">친구 관리 및 시간표</div>
    </div>

    <!-- My Schedule Tab -->
    <div class="tab-content active" id="my-schedule">
        <div class="actions-bar">
            <h3>나의 산책 일정</h3>
            <button class="btn btn-primary" id="addScheduleBtn">
                <i class="fas fa-plus"></i> 일정 추가
            </button>
            <button class="btn btn-secondary" id="addPetBtn" style="display: none;">
                <i class="fas fa-plus"></i> 반려견 등록
            </button>
        </div>

        <div class="schedule-container">
            <table class="schedule-table">
                <thead>
                <tr>
                    <th class="time-slot">시간대</th>
                    <th>일요일</th>
                    <th>월요일</th>
                    <th>화요일</th>
                    <th>수요일</th>
                    <th>목요일</th>
                    <th>금요일</th>
                    <th>토요일</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="time-slot">오전</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td class="time-slot">오후</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td class="time-slot">저녁</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 친구 관리 및 시간표 탭 - 재구성 -->
    <div class="tab-content" id="friend-schedule">
        <div class="actions-bar" id="friend-schedule-header">
            <h3>나의 친구 목록</h3>
            <!--        <div class="search-box">-->
            <!--            <input type="text" class="search-input" id="friendSearch" placeholder="친구 이름 검색...">-->
            <!--            <button class="btn btn-primary" id="searchFriendBtn">검색</button>-->
            <!--        </div>-->
            <button class="btn btn-secondary" id="addFriendBtn">
                <i class="fas fa-user-plus"></i> 친구 추가
            </button>
        </div>

        <!-- 친구 목록 섹션 -->
        <div class="friend-list">
        </div>

        <!-- 친구 시간표 섹션 - 처음에는 숨겨져 있음 -->
        <div class="friend-schedule-container" style="display: none;">
            <div class="friend-schedule-header">
                <h3 id="selectedFriendName">친구님의 산책 시간표</h3>
            </div>

            <table class="schedule-table" id="friend-schedule-table">
                <thead>
                <tr>
                    <th class="time-slot">시간대</th>
                    <th>일요일</th>
                    <th>월요일</th>
                    <th>화요일</th>
                    <th>수요일</th>
                    <th>목요일</th>
                    <th>금요일</th>
                    <th>토요일</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="time-slot">오전</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td class="time-slot">오후</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td class="time-slot">저녁</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                </tbody>
            </table>

            <div class="actions-bar" style="margin-top: 20px;">
                <button class="btn btn-outline back-to-friends-btn" id="requestWalkBtn">친구 목록으로 돌아가기</button>
            </div>
        </div>
    </div>

    <!-- Add Schedule Modal -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">산책 일정 추가</h3>
                <span class="modal-close" id="closeScheduleModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label class="form-label">요일</label>
                        <select class="form-select" id="day" required>
                            <option value="0">일요일</option>
                            <option value="1">월요일</option>
                            <option value="2">화요일</option>
                            <option value="3">수요일</option>
                            <option value="4">목요일</option>
                            <option value="5">금요일</option>
                            <option value="6">토요일</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">시간대</label>
                        <select class="form-select" id="period" required>
                            <option value="morning">오전</option>
                            <option value="afternoon">오후</option>
                            <option value="evening">저녁</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">시간</label>
                        <div class="form-time">
                            <input type="time" class="form-control form-time-input" id="startTime" required>
                            <span>~</span>
                            <input type="time" class="form-control form-time-input" id="endTime" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">장소</label>
                        <input type="text" class="form-control" id="place" placeholder="산책 장소" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">반려동물</label>
                        <select class="form-select" id="pet" required>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">메모</label>
                        <textarea class="form-control" id="memo" rows="3" placeholder="추가 메모사항"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="cancelScheduleBtn">취소</button>
                <button type="button" class="btn btn-primary" id="saveScheduleBtn">저장</button>
            </div>
        </div>
    </div>

    <!-- Add Friend Modal -->
    <div class="modal" id="friendModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">친구 추가</h3>
                <span class="modal-close" id="closeFriendModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">이메일로 검색</label>
                    <div class="search-box">
                        <input type="text" class="form-control" id="friendSearchInput" placeholder="이메일 입력">
                        <button class="btn btn-primary" id="friendSearchBtn">검색</button>
                    </div>
                </div>
                <div class="search-results" id="friendSearchResults" style="display: none;">
                    <h4 class="mb-10">검색 결과</h4>
                    <div class="friend-card">
                        <div class="friend-header">
                            <div class="friend-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="friend-info">
                                <div class="friend-name"></div>
                                <div class="friend-pets"></div>
                            </div>
                        </div>
                        <div class="friend-body">
                            <button class="btn btn-primary" id="sendFriendRequest">친구 요청 보내기</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="cancelFriendBtn">닫기</button>
            </div>
        </div>
    </div>

    <div id="scheduleDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">산책 일정 상세</h2>
                <button type="button" class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="pet-profile">
                    <img id="pet-image" src="/api/placeholder/100/100" alt="반려동물 사진" class="pet-image">
                    <div class="pet-info">
                        <div class="pet-name" id="pet-name"></div>
                        <div class="pet-details">
                            <span class="pet-detail-label">종류:</span>
                            <span class="pet-detail-value" id="pet-breed"></span>

                            <span class="pet-detail-label">생일:</span>
                            <span class="pet-detail-value" id="pet-birthday"></span>

                            <span class="pet-detail-label">나이:</span>
                            <span class="pet-detail-value" id="pet-age"></span>
                        </div>
                    </div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">요일</span>
                    <div class="detail-value" id="detail-day"></div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">시간대</span>
                    <div class="detail-value" id="detail-period"></div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">시간</span>
                    <div class="detail-value" id="detail-time"></div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">장소</span>
                    <div class="detail-value" id="detail-place"></div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">메모</span>
                    <div class="detail-value" id="detail-memo"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="scheduleDeleteBtn" >일정 삭제</button>
                <button type="button" class="btn btn-secondary" id="scheduleDetailCloseBtn" >닫기</button>
            </div>
        </div>
    </div>
</section>

<script src="/assets/js/common.js"></script>
<script src="/assets/js/auth.js"></script>
<script src="/assets/js/schedule.js"></script>
<script src="/assets/js/modal.js"></script>
<script src="/assets/js/friend.js"></script>
<script>
    // 친구 시간표 보기 기능 추가
    document.addEventListener('DOMContentLoaded', () => {
        loadFriends();
        loadSchedules();
        loadPets();
        tabItems();
        checkAuthStatus();
    });

    // 친구 목록으로 돌아가기 버튼
    document.querySelector('.back-to-friends-btn').addEventListener('click', function() {
        document.querySelector('.friend-schedule-container').style.display = 'none';
        document.querySelector('.friend-list').style.display = 'grid';
        document.querySelector('#friend-schedule-header').style.display = 'flex';
    });

    document.querySelector('#addPetBtn').addEventListener('click',function () {
        window.location.href = '../mypage.html';
    })

    // 탭 기능 초기화
    function tabItems() {
        const tabItems = document.querySelectorAll('.tab-item');
        const tabContents = document.querySelectorAll('.tab-content');

        tabItems.forEach(item => {
            item.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');

                tabItems.forEach(tab => tab.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                this.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });
    }

    /* pet 정보 불러오기 */
    async function loadPets() {
        try {
            const res = await fetch('/schedules/pet');
            const pets = await res.json();

            const petSelect = document.getElementById('pet');
            const addScheduleBtn = document.getElementById('addScheduleBtn');
            const addPetBtn = document.getElementById('addPetBtn'); // "펫 추가하기" 버튼

            petSelect.innerHTML = ''; // 기존 옵션 제거

            if (Array.isArray(pets) && pets.length > 0) {
                pets.forEach(p => {
                    const label = `${p.name}(${p.breed})`;
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = label;
                    petSelect.appendChild(option);
                });

                // 펫이 있으므로 일정 추가 버튼 보이기, 펫 추가 버튼 숨기기
                addScheduleBtn.style.display = 'inline-block';
                if (addPetBtn) addPetBtn.style.display = 'none';
            } else {
                // 펫이 없으므로 일정 추가 버튼 숨기기, 펫 추가 버튼 보이기
                addScheduleBtn.style.display = 'none';
                if (addPetBtn) addPetBtn.style.display = 'inline-block';
            }
        } catch (err) {
            console.error(err);
        }
    }

    function formatPetList(pets) {
        if (!pets || pets.length === 0) return '없음';
        return pets.map(p => `${escapeHtml(p.name)}(${escapeHtml(p.breed)})`).join(', ');
    }
</script>
</body>
</html>