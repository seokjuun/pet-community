<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>펫 포테이토 커뮤니티</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/global.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/variables.css">
    <link rel="stylesheet" href="/assets/css/button.css">
    <link rel="stylesheet" href="/assets/css/footer.css">

    <style>
        /* Hero Section - 크기 축소 */
        .hero {
            padding: 20px 0; /* 기존 60px에서 20px로 축소 */
            /*background-color: rgba(255, 138, 169, 0.1);*/
            background-color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* 약간의 그림자 추가로 위쪽 섹션 강조 */
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .hero-text {
            flex: 1.2;
            min-width: 300px;
            text-align: center;
            padding-right: 30px;
            z-index: 2;
        }

        .hero-image {
            flex: 0.8;
            min-width: 150px;
            max-width: 200px; /* 이미지 최대 크기 제한 */
            text-align: center;
            z-index: 2;
        }

        .hero-image img {
            max-width: 100%;
            border-radius: 20px;
            box-shadow: none;
            transition: transform 0.3s;
        }

        .hero h1 {
            font-size: 32px; /* 기존 39px에서 축소 */
            margin-bottom: 15px; /* 기존 20px에서 축소 */
            color: var(--dark);
        }

        .hero p {
            font-size: 16px; /* 기존 18px에서 축소 */
            color: #666;
            margin-bottom: 20px; /* 기존 30px에서 축소 */
        }

        /*.hero::before {*/
        /*    content: '';*/
        /*    position: absolute;*/
        /*    top: -100px;*/
        /*    right: -100px;*/
        /*    width: 300px;*/
        /*    height: 300px;*/
        /*    border-radius: 50%;*/
        /*    background-color: rgba(248, 165, 194, 0.1);*/
        /*    z-index: 1;*/
        /*}*/

        /*.hero::after {*/
        /*    content: '';*/
        /*    position: absolute;*/
        /*    bottom: -100px;*/
        /*    left: -100px;*/
        /*    width: 200px;*/
        /*    height: 200px;*/
        /*    border-radius: 50%;*/
        /*    background-color: rgba(255, 143, 171, 0.1);*/
        /*    z-index: 1;*/
        /*}*/

        /* Popular Posts */
        .popular-posts {
            padding: 60px 0;
            /*background-color: var(--light);*/
            background-color: #f7f8fa;
            border-top: 1px solid #eee;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title h2 {
            font-size: 32px;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .section-title p {
            color: #777;
        }

        /* 카테고리 필터 스타일 */
        .category-filter {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }

        .category-btn {
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            border: 2px solid var(--primary);
            background-color: transparent;
            color: var(--dark);
            font-weight: 500;
            transition: all 0.3s;
        }

        .category-btn:hover {
            background-color: var(--primary);
            color: white;
        }

        .category-btn.active {
            background-color: var(--primary);
            color: white;
        }

        /* 게시글 리스트 */
        .posts-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .post-item {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .post-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .post-stats {
            margin-right: 20px;
            text-align: center;
            min-width: 80px;
        }

        .post-views {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .post-likes {
            font-size: 14px;
            color: #777;
        }

        .post-content {
            flex: 1;
        }

        .post-content h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .post-meta {
            display: flex;
            font-size: 13px;
            color: #777;
            gap: 15px;
            flex-wrap: wrap;
        }

        .no-posts {
            text-align: center;
            padding: 30px;
            background-color: white;
            border-radius: 10px;
            color: #777;
        }

        .loading {
            text-align: center;
            padding: 30px;
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .header-main .container {
                flex-direction: column;
                gap: 15px;
            }

            .nav-menu {
                margin-top: 15px;
                margin-bottom: 15px;
                justify-content: center;
            }

            .nav-menu li {
                margin: 0 10px;
            }

            .hero h1 {
                font-size: 28px;
            }

            .hero-content {
                flex-direction: column;
            }

            .hero-text {
                text-align: center;
                padding-right: 0;
                margin-bottom: 20px;
            }

            .category-filter {
                flex-direction: row;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .post-stats {
                min-width: 60px;
            }
        }
    </style>
</head>
<body>
<!-- Header -->
<header>
    <div class="header-top">
        <div class="container">
            <div class="header-contact">
                <span><i class="fas fa-phone"></i> +82 10-1717-6288</span>
                <span><i class="fas fa-envelope"></i> info@petpotato.com</span>
            </div>
            <div class="header-social">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>
    <div class="header-main">
        <div class="container">
            <a href="index.html" class="logo">Pet Potato</a>
            <ul class="nav-menu">
                <li><a href="index.html">홈</a></li>
                <li><a href="boards/free.html">커뮤니티</a></li>
                <li><a href="boards/schedules.html">산책 시간표</a></li>
            </ul>
            <div class="auth-buttons" id="authButtons" style="display: flex; align-items: center; gap: 10px;">
                <a href="login.html" class="btn btn-outline">로그인</a>
                <a href="register.html" class="btn btn-primary">회원가입</a>
            </div>
        </div>
    </div>
</header>

<!-- Hero Section - 크기 축소됨 -->
<section class="hero">
    <div class="container">
        <div class="hero-content">
            <div class="hero-image">
                <img src="/assets/image/banner-img.png" alt="행복한 강아지" />
            </div>
            <div class="hero-text">
                <h1>반려동물과 함께하는 행복한 커뮤니티</h1>
                <p>펫 포테이토에서 다양한 반려동물 정보를 공유하고, 소통하며, 함께 성장해보세요.</p>
                <a href="boards/free.html" class="btn btn-primary">커뮤니티 둘러보기</a>
            </div>
        </div>
    </div>
</section>

<!-- Popular Posts with Category Filter -->
<section class="popular-posts">
    <div class="container">
        <div class="section-title">
            <h2>인기 게시글</h2>
            <p>48시간 이내의 인기 게시글을 확인해보세요</p>
        </div>

        <!-- 카테고리 필터 -->
        <div class="category-filter">
            <button class="category-btn active" data-category="all">전체</button>
            <button class="category-btn" data-category="POST_FREE">자유</button>
            <button class="category-btn" data-category="POST_BEAUTY">미용</button>
            <button class="category-btn" data-category="POST_MEDICAL">의료</button>
            <button class="category-btn" data-category="POST_WALKING">산책</button>
        </div>

        <!-- 게시글 목록 -->
        <div class="posts-list" id="popular-posts-list">
            <div class="loading">게시글을 불러오는 중입니다...</div>
        </div>
    </div>
</section>

<!-- Footer -->
<footer>
    <div class="footer-bottom">
        <div class="container">
            <p>&copy; 2025 펫 포테이토 커뮤니티. All Rights Reserved.</p>
        </div>
    </div>
</footer>

<script>
    // 로그인 상태에 따라 버튼 변경
    document.addEventListener('DOMContentLoaded', function() {
        // API 호출하여 현재 로그인 상태 확인
        fetch('/auth/me')
            .then(response => response.json())
            .then(user => {
                const authButtons = document.getElementById('authButtons');

                if (user && user.userId) {
                    // 로그인 상태인 경우
                    authButtons.innerHTML = `
                            <span style="margin-right: 10px;">${user.nickname || user.username}님</span>
                            <a href="mypage.html" class="btn btn-outline">마이페이지</a>
                            <button onclick="logout()" class="btn btn-primary">로그아웃</button>
                        `;
                }
            })
            .catch(error => {
                console.error('로그인 상태 확인 오류:', error);
            });

        // 초기 인기 게시글 로드 (전체 카테고리)
        loadPopularPosts('all');

        // 카테고리 버튼 이벤트 리스너 설정
        const categoryButtons = document.querySelectorAll('.category-btn');
        categoryButtons.forEach(button => {
            button.addEventListener('click', function() {
                // 활성화된 버튼 스타일 적용
                categoryButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                // 선택된 카테고리의 게시글 로드
                const category = this.getAttribute('data-category');
                loadPopularPosts(category);
            });
        });
    });

    // 로그아웃 함수
    function logout() {
        fetch('/auth/logout', {
            method: 'POST'
        })
            .then(response => response.text())
            .then(result => {
                if (result === 'logout success') {
                    alert('로그아웃 되었습니다.');
                    window.location.href = 'index.html';
                }
            })
            .catch(error => {
                console.error('로그아웃 오류:', error);
            });
    }

    // 인기 게시글 불러오기 함수 (카테고리별 필터링 추가)
    function loadPopularPosts(category) {
        const postsListContainer = document.getElementById('popular-posts-list');
        postsListContainer.innerHTML = '<div class="loading">게시글을 불러오는 중입니다...</div>';

        let apiUrl = '/api/posts/popular?page=0&size=8&hours=48';

        // 카테고리가 전체가 아닌 경우 해당 카테고리만 필터링
        if (category !== 'all') {
            apiUrl += `&hashtagId=${category}`;
        }

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                postsListContainer.innerHTML = '';

                if (data.postList && data.postList.length > 0) {
                    data.postList.forEach(post => {
                        const postElement = createPostElement(post);
                        postsListContainer.appendChild(postElement);
                    });
                } else {
                    postsListContainer.innerHTML = '<div class="no-posts">해당 카테고리의 인기 게시글이 없습니다.</div>';
                }
            })
            .catch(error => {
                console.error('인기 게시글을 불러오는 중 오류가 발생했습니다:', error);
                postsListContainer.innerHTML = '<div class="no-posts">게시글을 불러오는 중 오류가 발생했습니다.</div>';
            });
    }

    function createPostElement(post) {
        // Format date
        const createdDate = new Date(post.createdAt);
        const now = new Date();
        const diffTime = Math.abs(now - createdDate);
        const diffHours = Math.floor(diffTime / (1000 * 60 * 60));

        let timeAgo;
        if (diffHours < 1) {
            timeAgo = '방금 전';
        } else if (diffHours < 24) {
            timeAgo = diffHours + '시간 전';
        } else {
            timeAgo = Math.floor(diffHours / 24) + '일 전';
        }

        // Create post item container
        const postItem = document.createElement('div');
        postItem.className = 'post-item';
        postItem.setAttribute('data-post-id', post.postId);

        // Post stats (likes and views)
        const postStats = document.createElement('div');
        postStats.className = 'post-stats';

        const postViews = document.createElement('div');
        postViews.className = 'post-views';
        postViews.textContent = post.viewCount;

        const postLikes = document.createElement('div');
        postLikes.className = 'post-likes';
        postLikes.innerHTML = '<i class="fas fa-heart"></i> ' + post.postLikes;

        postStats.appendChild(postViews);
        postStats.appendChild(postLikes);

        // Post content
        const postContent = document.createElement('div');
        postContent.className = 'post-content';

        const postTitle = document.createElement('h3');
        postTitle.textContent = post.title;

        const postMeta = document.createElement('div');
        postMeta.className = 'post-meta';

        // Username
        const username = document.createElement('span');
        username.innerHTML = `<i class="fas fa-user"></i> ${post.username}`;

        // Hashtag
        const hashtag = document.createElement('span');
        hashtag.innerHTML = `<i class="fas fa-folder"></i> ${post.hashtagName}`;

        // Time
        const time = document.createElement('span');
        time.innerHTML = `<i class="fas fa-clock"></i> ${timeAgo}`;

        postMeta.appendChild(username);
        postMeta.appendChild(hashtag);
        postMeta.appendChild(time);

        postContent.appendChild(postTitle);
        postContent.appendChild(postMeta);

        // Add click event to navigate to post details
        postItem.addEventListener('click', function() {
            window.location.href = `/post.html?id=${post.postId}`;
        });

        // Append elements to post item
        postItem.appendChild(postStats);
        postItem.appendChild(postContent);

        return postItem;
    }
</script>
</body>
</html>